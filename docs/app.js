"use strict";function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i]}return arr2}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(arr,i){if(!(Symbol.iterator in Object(arr)||Object.prototype.toString.call(arr)==="[object Arguments]")){return}var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj}}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&_typeof(value)==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value){__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key))}return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=0)})([function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)},function(module,exports,__webpack_require__){var json={};__webpack_require__(2);yodasws.page("home").setRoute({template:"pages/home.html",route:"/"})},function(module,exports){yodasws.page("play/main").setRoute({template:"pages/play/main/main.html",route:"/play/main/"}).on("load",function(){console.log("Player:",game.players[0]);game.btnSkip=document.getElementById("btnSkip");game.btnSkip.addEventListener("click",function(e){game.buildMap();game.doAction()});game.boardActions=document.getElementById("action-board");game.actionButtons;game.boardMap=document.getElementById("map-board");game.info={top:document.getElementById("top-info")};game.startGame()});window.game={round:0,players:[],nextPlayerOrder:[],currentPlayer:0,currentActions:[],map:new Array(5).fill(0).map(function(a){return new Array(3).fill("").map(function(){return new Tile("grass")})}),buildings:{mine:{name:"Mine"},papermill:{name:"Papermill"},sawmill:{name:"Sawmill"},quarry:{name:"Quarry"},"oil-rig":{name:"Oil Rig",terrain:["ocean"]},"coal-burner":{name:"Coal Burner"},mint:{name:"Mint"},"stock-exchange":{name:"Stock Exchange"}},supplies:{"Sheep":0,"Boar":0,"Cattle":0,"Horse":0,"Wood":0,"Clay":0,"Reed":0,"stone-1":0,"stone-2":0,"reed-stone-food":0,"reed-stone-wood":0},actions:[{action:"build",text:"<b>Build Improvements</b>"},{action:"starting-player",text:"<b>Starting Player</b>"},{action:"Grain",text:"<b>Take 1 Grain</b>"},{action:"plow",text:"<b>Plow 1 Farmland</b>"},{action:"sow",text:"<b>Sow</b><br/>and/or<br/><b>Bake Bread</b>",round:1},{action:"plow-sow",text:"<b>Plow 1 Farmland</b><br/>and/or<br/><b>Sow</b>",round:5},{action:"road",text:"<b>Build Road</b>"},{action:"laborer",text:"<b>Day Laborer</b>"},{action:"fishing",text:"<b>Fishing</b><br/>2 Food"},{action:"hire",text:"<b>Hire Worker</b>",round:2},{action:"hire-wo-room",text:"<b>Hire Worker</b> even without room",round:5},{action:"fences",text:"<b>Fences</b>",round:1},{action:"Sheep",text:"<b><output></output> Sheep</b>",round:1},{action:"Boar",text:"<b><output></output> Wild Boar</b>",round:3},{action:"Cattle",text:"<b><output></output> Cattle</b>",round:4},{action:"Horse",text:"<b><output></output> Horse</b>",round:5},{action:"animal",text:"<b>1 Sheep and 1 Food</b><br/>or <b>1 Wild Boar</b><br/>or pay 1 Food for <b>1 Cattle</b>",round:5},{action:"Vegetable",text:"<b>Take 1 Vegetable</b>",round:3},{action:"Wood",text:"<b><output></output> Wood</b>"},{action:"Clay",text:"<b><output></output> Clay</b>"},{action:"Reed",text:"<b><output></output> Reed</b>"},{action:"stone-1",text:"<b><output></output> Stone</b>",round:2},{action:"stone-2",text:"<b><output></output> Stone</b>",round:4},{action:"reed-stone-food",text:"<b><output></output> Reed</b>,<br/><b><output></output> Stone</b>,<br/>and <b><output></output> Food</b></b>",players:4},{action:"reed-stone-wood",text:"<b><output></output> Reed</b><br/>also <b>1 Stone and 1 Wood</b>",players:5},{action:"build-traveling",text:"<b>Build 1 Improvement</b><br/>or<br/><b>Traveling Players</b>",players:5}],startGame:function startGame(){var buttonHolder=document.getElementById("action-buttons");Object.entries(game.buildings).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),id=_ref2[0],btn=_ref2[1];var el=document.createElement("button");el.addEventListener("click",game.build);el.setAttribute("hidden","");buttonHolder.appendChild(el);el.dataset.action="build";el.dataset.improvement=id;el.innerText=btn.name});game.actionButtons=document.querySelectorAll("#action-buttons button");var infoBox=document.getElementById("player-info");Object.entries(game.player.supplies).forEach(function(_ref3){var _ref4=_slicedToArray(_ref3,2),key=_ref4[0],num=_ref4[1];var div=document.createElement("div");div.innerHTML="".concat(key,": <output data-supply=\"").concat(key,"\">").concat(num);infoBox.appendChild(div)});game.buildMap();game.startRound()},startRound:function startRound(){var _this=this;this.round++;Object.entries(this.supplies).forEach(function(_ref5){var _ref6=_slicedToArray(_ref5,2),key=_ref6[0],num=_ref6[1];if(["Sheep","Boar","Cattle","Horse","stone-1","stone-2"].includes(key)){if(_this.round>=_this.actions.filter(function(a){return a.action===key})[0].round)_this.supplies[key]++}else if(key==="Wood"){_this.supplies[key]+=3}else{_this.supplies[key]++}});game.boardActions.classList.remove("end");game.boardActions.querySelectorAll("button").forEach(function(btn){game.boardActions.removeChild(btn)});this.actions.forEach(function(action){if(action.round&&_this.round<action.round){return}if(action.players&&action.players!==_this.players.length){return}var btn=document.createElement("button");btn.innerHTML=action.text;btn.dataset.action=action.action;btn.addEventListener("click",_this.takeAction);_toConsumableArray(btn.querySelectorAll("output")).forEach(function(output){output.innerText=_this.supplies[action.action]});game.boardActions.appendChild(btn)});_toConsumableArray(game.boardActions.querySelectorAll("button")).forEach(function(btn){btn.removeAttribute("disabled")});this.players.forEach(function(player){player.availableWorkers=player.workers});this.currentPlayer=0;game.startTurn()},startTurn:function startTurn(){game.boardActions.classList.remove("disabled");game.boardActions.scrollIntoView({behavior:"smooth",block:"center"});game.boardActions.querySelector("button:enabled").focus();game.info.top.innerHTML="Current Player: <b>".concat(game.players[game.currentPlayer].name,"</b>")},takeAction:function takeAction(e){if(game.currentActions.length||game.boardActions.classList.contains("disabled")){return}game.boardActions.classList.add("disabled");var player=game.players[game.currentPlayer];if(player.availableWorkers<=0){return}var action=e instanceof Event?e.currentTarget.dataset.action:e;var actionTile=e instanceof Event?e.currentTarget:document.querySelector("button[data-action=\"".concat(action,"\"]"));actionTile.setAttribute("disabled","");player.availableWorkers--;if(game.supplies[action]){_toConsumableArray(actionTile.querySelectorAll("output")).forEach(function(output){output.innerText=0});switch(action){case"Cattle":case"Horse":case"Sheep":case"Boar":case"Clay":case"Reed":case"Wood":player.supplies[action]+=game.supplies[action];break;case"stone-1":case"stone-2":player.supplies.Stone+=game.supplies[action];break;case"reed-stone-food":player.supplies.Stone+=game.supplies[action];player.supplies.Reed+=game.supplies[action];player.supplies.Food+=game.supplies[action];break;case"reed-stone-wood":player.supplies.Stone+=game.supplies[action];player.supplies.Reed+=game.supplies[action];player.supplies.Wood+=game.supplies[action];break;}game.supplies[action]=0}switch(action){case"build-traveling":break;case"plow-sow":game.currentActions=["plow","sow"];break;case"fences":break;case"animal":break;default:game.currentActions.push(action);}game.doAction()},doAction:function doAction(){game.hideActions();var action=game.currentActions.shift();if(!action){game.endAction();return}var player=game.players[game.currentPlayer];switch(action){case"build":game.buildSubActionBoard(action);return;case"build-traveling":break;case"starting-player":game.nextPlayerOrder=game.players.slice(game.currentPlayer).concat(game.players.slice(0,game.currentPlayer));break;case"Vegetable":case"Grain":player.supplies[action]++;break;case"plow":case"sow":game.buildSubActionBoard(action);game.buildMap(action);return;case"laborer":break;case"fishing":player.supplies.Food+=2;break;case"fences":break;case"hire":if(player.workers<5){player.workers++}break;case"hire-wo-room":if(player.workers<5){player.workers++}break;case"animal":break;}game.doAction()},endAction:function endAction(){var nextTurn=false;for(var i=0;i<game.players.length;i++){game.currentPlayer++;if(game.currentPlayer>=game.players.length){game.currentPlayer=0}if(game.players[game.currentPlayer].availableWorkers!==0){nextTurn=true;break}}game.updateInfo();if(nextTurn)game.startTurn();else game.endRound()},endRound:function endRound(){_toConsumableArray(game.boardActions.querySelectorAll("button")).forEach(function(btn){btn.setAttribute("disabled","")});game.info.top.innerHTML="End of Round";game.info.top.scrollIntoView({behavior:"smooth",block:"center"});if(game.nextPlayerOrder.length){game.players=game.nextPlayerOrder;game.nextPlayerOrder=[]}setTimeout(function(){game.startRound()},1000)},updateInfo:function updateInfo(){document.querySelectorAll("#player-info output").forEach(function(output){output.innerHTML=game.player.supplies[output.dataset.supply]})},buildMap:function buildMap(action){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var initialBuild=game.boardMap.innerHTML==="";game.map.forEach(function(r1,r2){r1.forEach(function(c1,c2){c1.html.innerHTML="";c1.html.dataset.col=c2;c1.html.dataset.row=r2;c1.html.dataset.use=c1.improvements.join(" ");switch(action){case"build":{var improvement=game.buildings[options.improvement];if(!improvement)break;if(c1.improvements.length>0)break;if(!(improvement.terrain||["plains","grass"]).includes(c1.terrain)){break}var _btn=document.createElement("button");_btn.innerHTML="Build Here";_btn.addEventListener("click",game.buildHere);_btn.dataset.improvement=options.improvement;c1.html.appendChild(_btn);break}case"plow":{if(c1.improvements.length>0||!["plains","grass"].includes(c1.terrain)){break}var _btn2=document.createElement("button");_btn2.innerHTML="Plow Farmland";_btn2.addEventListener("click",game.plow);c1.html.appendChild(_btn2);break}case"sow":{if(!c1.improvements.includes("farm")){break}["Grain","Vegetable"].forEach(function(plant,i,plants){if(c1.improvements.intersects(plants)){return}if(game.players[game.currentPlayer].supplies[plant]>0){var _btn3=document.createElement("button");_btn3.innerHTML="Sow ".concat(plant);_btn3.addEventListener("click",function(e){return game.sow(e,plant)});c1.html.appendChild(_btn3)}});break}}if(initialBuild)game.boardMap.appendChild(c1.html)})});game.boardMap.style.gridTemplateColumns="repeat(".concat(game.map[0].length,", 1fr)");game.boardMap.style.gridTemplateRows="repeat(".concat(game.map.length,", 1fr)");var btn=game.boardMap.querySelector("button:enabled");if(btn instanceof Element){btn.focus()}game.boardMap.scrollIntoView({behavior:"smooth",block:"center"})},buildSubActionBoard:function buildSubActionBoard(action){game.actionButtons.forEach(function(btn){if(btn.dataset.action.includes(action)){btn.removeAttribute("hidden")}});switch(action){case"plow":case"sow":game.btnSkip.removeAttribute("hidden");break;}document.querySelector("#action-buttons button:not([hidden])").focus()},hideActions:function hideActions(){game.actionButtons.forEach(function(btn){return btn.setAttribute("hidden","")})},plow:function plow(e){var farm=e.currentTarget.closest(".tile");var _ref7=[farm.dataset.col,farm.dataset.row],col=_ref7[0],row=_ref7[1];game.map[row][col].improvements.push("farm");game.buildMap();game.doAction()},sow:function sow(e,plant){if(game.players[game.currentPlayer].supplies[plant]<1){return}var farm=e.currentTarget.closest(".tile");var _ref8=[farm.dataset.col,farm.dataset.row],col=_ref8[0],row=_ref8[1];game.players[game.currentPlayer].supplies[plant]--;game.map[row][col].improvements.push(plant);game.map[row][col].supplies=_defineProperty({},plant,1);game.buildMap("sow")},build:function build(e){var btn=e.target;game.hideActions();game.buildMap("build",{improvement:btn.dataset.improvement});return},buildHere:function buildHere(e){var btn=e.target;var td=btn.closest(".tile");console.log("td:",td);var _ref9=[td.dataset.col,td.dataset.row],col=_ref9[0],row=_ref9[1];game.map[row][col].improvements.push(btn.dataset.improvement);console.log("tile:",game.map[row][col]);game.buildMap();game.doAction()}};game.actions.sort(function(a,b){if(!a.round&&!b.round){return 0}if(!a.round&&b.round){return-1}if(a.round&&!b.round){return 1}if(a.round===b.round){return Math.random()-0.5}return a.round-b.round}).filter(function(a,i){a.i=i;return!!a.round}).forEach(function(a,round){a.round=round+1});function Player(name){this.workers=2;this.availableWorkers=2;this.supplies={"Grain":0,"Vegetable":0,"Wood":0,"Clay":0,"Reed":0,"Stone":0,"Food":0};this.name=name}function Tile(terrain){if(!["grass","ocean","plains"].includes(terrain)){throw new Error("Unacceptable terrain type!")}this.terrain=terrain;this.improvements=[];this.html=document.createElement("div");this.html.classList.add("tile");this.html.dataset.terrain=terrain}Array.prototype.intersects=function(arr){return this.filter(function(e){return arr.includes(e)}).length>0};var names=["Ashley","Audrey","Jiaxin","Mathilde","Jane","Susan","Tara","Sally","Stephanie"];game.map=[["plains","plains","ocean","plains","plains"],["plains","grass","ocean","grass","plains"],["plains","grass","ocean","grass","plains"],["plains","plains","ocean","plains","plains"]].map(function(row){return row.map(function(cell){return new Tile(cell)})});var numPlayers=4;for(var i=0;i<numPlayers;i++){game.players.push(new Player(i===0?"You!":names[i]))}game.player=game.players[0]}]);